<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Issue/Return Books - LMS</title>
  <link rel="stylesheet" href="css/styles.css">
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/css/materialize.min.css" rel="stylesheet">
  <style>
    :root {
      --navy: #0a2342;
      --navy-dark: #06162a;
      --accent: #1e90ff;
      --white: #fff;
      --light-bg: #f4f8fb;
      --card-shadow: 0 2px 8px rgba(10,35,66,0.08);
    }
    body { background: var(--light-bg); }
    .nav-wrapper { background: var(--navy) !important; }
    .brand-logo { color: var(--white) !important; font-weight: 700; }
    .nav-wrapper ul li a { color: var(--white) !important; font-weight: 500; }
    .nav-wrapper ul li a.active, .nav-wrapper ul li a:focus, .nav-wrapper ul li a:hover {
      background: var(--accent) !important;
      color: var(--white) !important;
      border-radius: 4px;
    }
    .step-card, .card {
      background: var(--white);
      box-shadow: var(--card-shadow);
      border-radius: 12px;
      margin-bottom: 24px;
    }
    .card-title, .step-card .card-title {
      color: var(--navy);
      font-weight: 700;
    }
    .btn, .btn-large, .btn-floating {
      background: var(--accent) !important;
      color: var(--white) !important;
      border-radius: 24px;
      font-weight: 600;
      box-shadow: 0 2px 8px rgba(30,144,255,0.08);
      transition: background 0.2s;
    }
    .btn:hover, .btn-large:hover, .btn-floating:hover {
      background: var(--navy) !important;
      color: var(--white) !important;
    }
    .card-panel, .modal-content, .card-content {
      background: var(--white) !important;
      color: var(--navy-dark);
      border-radius: 12px;
    }
    .fixed-action-btn .btn-floating {
      background: var(--accent) !important;
      color: var(--white) !important;
    }
    .modal-content h5 { color: var(--navy); }
    .modal-footer .btn-flat { color: var(--accent) !important; }
    .tooltipped { outline: none; }
    @media (max-width: 600px) {
      .step-card, .card { min-width: 100%; }
      .container { padding: 0 4px; }
    }
    /* Fix Current Issues block */
    .current-issues-card {
      margin-top: 18px;
      margin-bottom: 18px;
      padding: 0;
      box-shadow: var(--card-shadow);
      border-radius: 12px;
      background: var(--white);
    }
    .current-issues-card .card-content {
      padding: 18px 18px 8px 18px;
    }
    .current-issues-card .card-title {
      margin-bottom: 12px;
    }
    .current-issues-table-wrapper {
      width: 100%;
      overflow-x: auto;
    }
    @media (max-width: 992px) {
      .current-issues-card {
        margin-top: 18px;
        margin-bottom: 18px;
        width: 100%;
      }
    }
    @media (max-width: 600px) {
      .current-issues-card {
        width: 100%;
        margin-left: 0;
        margin-right: 0;
      }
      .current-issues-card .card-content {
        padding: 10px 4px 4px 4px;
      }
      .current-issues-table-wrapper {
        padding: 0;
      }
    }
  </style>
</head>
<body>
  <nav class="nav-wrapper blue">
    <div class="container">
      <ul id="nav-mobile" class="right hide-on-med-and-down">
        <li><a href="dashboard.html"><i class="material-icons left">dashboard</i>Dashboard</a></li>
        <li><a href="books.html"><i class="material-icons left">menu_book</i>Books</a></li>
        <li><a href="users.html"><i class="material-icons left">group</i>Users</a></li>
        <li><a href="issue_return.html"><i class="material-icons left">assignment_returned</i>Issue/Return</a></li>
        <li><a href="fines.html"><i class="material-icons left">attach_money</i>Fines</a></li>
        <li><a href="reservations.html"><i class="material-icons left">event_available</i>Reservations</a></li>
        <li><a href="ebooks.html"><i class="material-icons left">picture_as_pdf</i>E-Books</a></li>
        <li><a href="profile.html"><i class="material-icons left">person</i>Profile</a></li>
      </ul>
    </div>
  </nav>
  <div class="container" style="margin-top:30px;">
    <div class="row">
      <div class="col s12 m8">
        <div class="card step-card">
          <div class="card-content">
            <span class="card-title"><i class="material-icons left">assignment_returned</i> Issue a Book</span>
            <form id="issueForm">
              <div class="input-field">
                <select id="issueUser" required class="tooltipped" data-tooltip="Select the user to issue the book to">
                  <option value="" disabled selected>Choose user</option>
                </select>
                <label for="issueUser">User <i class="material-icons tiny tooltipped" data-tooltip="Who is borrowing the book?">help_outline</i></label>
                <span class="helper-text">Select the user who will receive the book.</span>
              </div>
              <div class="input-field">
                <select id="issueBook" required class="tooltipped" data-tooltip="Select the book to issue">
                  <option value="" disabled selected>Choose book</option>
                </select>
                <label for="issueBook">Book <i class="material-icons tiny tooltipped" data-tooltip="Which book to issue?">help_outline</i></label>
                <span class="helper-text">Pick the book to be issued.</span>
              </div>
              <div class="input-field">
                <input type="date" id="dueDate" required class="tooltipped" data-tooltip="Set the due date for returning the book">
                <label for="dueDate">Due Date <i class="material-icons tiny tooltipped" data-tooltip="When should the book be returned?">help_outline</i></label>
                <span class="helper-text">Set the return deadline.</span>
              </div>
              <button type="submit" class="btn waves-effect waves-light tooltipped" data-tooltip="Issue Book"><i class="material-icons left">check</i>Issue Book</button>
            </form>
            <div class="success-message card-panel green lighten-4 center-align" id="issueSuccess" style="display:none">
              <i class="material-icons large green-text">check_circle</i>
              <p>Book issued successfully!</p>
            </div>
          </div>
        </div>
        <div class="card step-card">
          <div class="card-content">
            <span class="card-title"><i class="material-icons left">assignment_return</i> Return a Book</span>
            <form id="returnForm">
              <div class="input-field">
                <select id="returnTransaction" required class="tooltipped" data-tooltip="Select the issued book to return">
                  <option value="" disabled selected>Choose issued book</option>
                </select>
                <label for="returnTransaction">Issued Book <i class="material-icons tiny tooltipped" data-tooltip="Which book is being returned?">help_outline</i></label>
                <span class="helper-text">Select the book being returned.</span>
              </div>
              <button type="submit" class="btn waves-effect waves-light tooltipped" data-tooltip="Return Book"><i class="material-icons left">undo</i>Return Book</button>
            </form>
            <div class="success-message card-panel teal lighten-4 center-align" id="returnSuccess" style="display:none">
              <i class="material-icons large teal-text">check_circle</i>
              <p>Book returned successfully!</p>
            </div>
          </div>
        </div>
      </div>
      <div class="col s12 m4">
        <div class="card-panel">
          <b>Need help?</b> Click the <b>?</b> button below or hover over any <i class="material-icons tiny">help_outline</i> icon!
        </div>
        <div class="card current-issues-card">
          <div class="card-content">
            <span class="card-title"><i class="material-icons left">list</i> Current Issues</span>
            <div class="current-issues-table-wrapper">
              <table id="issuesTable" class="striped responsive-table">
                <thead>
                  <tr>
                    <th>User</th>
                    <th>Book</th>
                    <th>Issued On</th>
                    <th>Due Date</th>
                    <th>Status</th>
                  </tr>
                </thead>
                <tbody>
                  <!-- Issue rows go here -->
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  <div class="fixed-action-btn">
    <a class="btn-floating btn-large tooltipped" data-tooltip="Help & FAQ" href="#helpModal">
      <i class="material-icons">help_outline</i>
    </a>
  </div>
  <div id="helpModal" class="modal">
    <div class="modal-content">
      <h5>Help & FAQ</h5>
      <ul class="collection">
        <li class="collection-item">To issue a book, select the user, book, and due date, then click <b>Issue Book</b>.</li>
        <li class="collection-item">To return a book, select the issued book and click <b>Return Book</b>.</li>
        <li class="collection-item">Hover over any <i class="material-icons tiny">help_outline</i> icon for more info.</li>
        <li class="collection-item">For more help, contact your librarian or admin.</li>
      </ul>
    </div>
    <div class="modal-footer">
      <a href="#!" class="modal-close btn-flat">Close</a>
    </div>
  </div>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/js/materialize.min.js"></script>
  <script type="module" src="js/firebase.js"></script>
  <script type="module" src="js/issue_return.js"></script>
  <script type="module">
    import { auth, db } from './js/firebase.js';
    import { doc, getDoc } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";
    import { logout, highlightActiveNav } from './js/utils.js';
    document.addEventListener('DOMContentLoaded', function() {
      var modals = document.querySelectorAll('.modal');
      M.Modal.init(modals);
      var tooltipped = document.querySelectorAll('.tooltipped');
      M.Tooltip.init(tooltipped);
    });
    auth.onAuthStateChanged(async (user) => {
      if (user) {
        const userDoc = await getDoc(doc(db, "users", user.uid));
        const role = userDoc.exists() ? userDoc.data().role : null;
        if (role !== "admin") {
          document.querySelectorAll('.admin-only').forEach(el => el.style.display = 'none');
        }
      }
    });
    document.getElementById('logoutBtn').onclick = logout;
    highlightActiveNav();
    window.showIssueSuccess = function() {
      document.getElementById('issueSuccess').classList.add('active');
      setTimeout(() => document.getElementById('issueSuccess').classList.remove('active'), 2000);
    }
    window.showReturnSuccess = function() {
      document.getElementById('returnSuccess').classList.add('active');
      setTimeout(() => document.getElementById('returnSuccess').classList.remove('active'), 2000);
    }
  </script>
  <script src="js/navHighlight.js"></script>
</body>
</html> 